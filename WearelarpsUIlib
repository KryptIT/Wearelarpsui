

local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local HttpService = game:GetService("HttpService")
local TextService = game:GetService("TextService")

local Library = {}
local player = Players.LocalPlayer
local mouse = player:GetMouse()
local notifications = {}
local notificationContainer = nil

-- Utility functions
local function create(className, properties)
	local obj = Instance.new(className)
	for prop, val in pairs(properties) do
		obj[prop] = val
	end
	return obj
end

local function tween(obj, goalProps, time, easingStyle, easingDirection)
	local tweenInfo = TweenInfo.new(time or 0.2, easingStyle or Enum.EasingStyle.Quad, easingDirection or Enum.EasingDirection.Out)
	local tween = TweenService:Create(obj, tweenInfo, goalProps)
	tween:Play()
	return tween
end

local function request(url)
	local success, response = pcall(function()
		if syn and syn.request then
			return syn.request({Url = url, Method = "GET"})
		else
			return {Body = game:HttpGet(url), StatusCode = 200}
		end
	end)
	if success then
		return response
	else
		return {Body = "", StatusCode = 500}
	end
end

-- Notification system
function Library:Notify(config)
	config = config or {}
	config.Title = config.Title or "Notification"
	config.Content = config.Content or ""
	config.Duration = config.Duration or 5
	config.Type = config.Type or "info" -- "info", "success", "warning", "error"
	config.Theme = config.Theme or {
		Background = Color3.fromRGB(30,30,30),
		Text = Color3.fromRGB(255,255,255),
		Accent = Color3.fromRGB(0,170,255),
		Transparency = 0.1
	}

	if not notificationContainer then
		notificationContainer = create("ScreenGui", {
			Name = "NotificationContainer",
			Parent = player.PlayerGui,
			ResetOnSpawn = false,
			ZIndexBehavior = Enum.ZIndexBehavior.Sibling
		})
		local holder = create("Frame", {
			Parent = notificationContainer,
			Size = UDim2.new(0, 350, 0, 500),
			Position = UDim2.new(1, -360, 0, 20),
			BackgroundTransparency = 1
		})
		local list = create("UIListLayout", {
			Parent = holder,
			SortOrder = Enum.SortOrder.LayoutOrder,
			Padding = UDim.new(0, 8)
		})
		notificationContainer.Holder = holder
	end

	local typeColors = {
		info = config.Theme.Accent,
		success = Color3.fromRGB(50, 200, 50),
		warning = Color3.fromRGB(255, 170, 0),
		error = Color3.fromRGB(220, 50, 50)
	}
	local accentColor = typeColors[config.Type] or config.Theme.Accent

	local notif = create("Frame", {
		Parent = notificationContainer.Holder,
		Size = UDim2.new(1, 0, 0, 0),
		BackgroundColor3 = config.Theme.Background,
		BackgroundTransparency = config.Theme.Transparency,
		BorderSizePixel = 0,
		ClipsDescendants = true
	})
	create("UICorner", {Parent = notif, CornerRadius = UDim.new(0, 10)})
	create("UIStroke", {Parent = notif, Thickness = 1, Color = Color3.new(0,0,0), Transparency = 0.7})

	local title = create("TextLabel", {
		Parent = notif,
		Size = UDim2.new(1, -20, 0, 25),
		Position = UDim2.new(0, 10, 0, 8),
		BackgroundTransparency = 1,
		Text = config.Title,
		TextColor3 = accentColor,
		Font = Enum.Font.GothamBold,
		TextSize = 18,
		TextXAlignment = Enum.TextXAlignment.Left
	})

	local content = create("TextLabel", {
		Parent = notif,
		Size = UDim2.new(1, -20, 0, 0),
		Position = UDim2.new(0, 10, 0, 35),
		BackgroundTransparency = 1,
		Text = config.Content,
		TextColor3 = config.Theme.Text,
		Font = Enum.Font.Gotham,
		TextSize = 15,
		TextXAlignment = Enum.TextXAlignment.Left,
		TextWrapped = true,
		RichText = true
	})

	local contentSize = TextService:GetTextSize(config.Content, 15, Enum.Font.Gotham, Vector2.new(330, math.huge))
	local contentHeight = math.max(contentSize.Y + 10, 20)
	content.Size = UDim2.new(1, -20, 0, contentHeight)

	local totalHeight = 25 + contentHeight + 20
	notif.Size = UDim2.new(1, 0, 0, totalHeight)

	local progressBar = create("Frame", {
		Parent = notif,
		Size = UDim2.new(1, 0, 0, 4),
		Position = UDim2.new(0, 0, 1, -4),
		BackgroundColor3 = accentColor,
		BorderSizePixel = 0
	})
	create("UICorner", {Parent = progressBar, CornerRadius = UDim.new(0, 2)})

	local closeBtn = create("TextButton", {
		Parent = notif,
		Size = UDim2.new(0, 30, 0, 30),
		Position = UDim2.new(1, -35, 0, 5),
		BackgroundTransparency = 1,
		Text = "✕",
		TextColor3 = Color3.fromRGB(200,200,200),
		Font = Enum.Font.Gotham,
		TextSize = 20,
		AutoButtonColor = false
	})
	closeBtn.MouseEnter:Connect(function()
		tween(closeBtn, {TextColor3 = Color3.new(1,1,1)}, 0.1)
	end)
	closeBtn.MouseLeave:Connect(function()
		tween(closeBtn, {TextColor3 = Color3.fromRGB(200,200,200)}, 0.1)
	end)
	closeBtn.MouseButton1Click:Connect(function()
		tween(notif, {Size = UDim2.new(1, 0, 0, 0), BackgroundTransparency = 1}, 0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
		wait(0.2)
		notif:Destroy()
	end)

	notif.Position = UDim2.new(1, 10, 0, 0)
	tween(notif, {Position = UDim2.new(0, 0, 0, 0)}, 0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out)

	local startTime = tick()
	local connection
	connection = RunService.Heartbeat:Connect(function()
		local elapsed = tick() - startTime
		local remaining = math.clamp(1 - elapsed / config.Duration, 0, 1)
		progressBar.Size = UDim2.new(remaining, 0, 0, 4)
		if elapsed >= config.Duration then
			connection:Disconnect()
			tween(notif, {Position = UDim2.new(1, 10, 0, 0), BackgroundTransparency = 1}, 0.3, Enum.EasingStyle.Back, Enum.EasingDirection.In)
			wait(0.3)
			notif:Destroy()
		end
	end)
end

-- Key system
function Library:KeySystem(config)
	config = config or {}
	config.Title = config.Title or "Key System"
	config.Url = config.Url or ""
	config.Theme = config.Theme or {
		Background = Color3.fromRGB(20,20,20),
		Text = Color3.fromRGB(255,255,255),
		Accent = Color3.fromRGB(0,170,255),
		Transparency = 0.1,
		Font = Enum.Font.GothamBold
	}

	local window = Library:CreateWindow({
		Title = config.Title,
		Theme = config.Theme,
		Size = UDim2.new(0, 400, 0, 200)
	})

	local status = window:AddLabel("Enter your key below")
	local input = window:AddInput("Key", "", function() end)
	local button = window:AddButton("Validate", function()
		local key = input:GetText()
		if key == "" then
			status:SetText("Please enter a key")
			return
		end
		status:SetText("Validating...")
		local response = request(config.Url .. "?key=" .. key)
		if response.StatusCode == 200 and string.find(response.Body:lower(), "success") then
			status:SetText("Key accepted! Loading...")
			wait(1)
			window:Destroy()
			if config.Callback then config.Callback(true) end
		else
			status:SetText("Invalid key")
			if config.Callback then config.Callback(false) end
		end
	end)

	return window
end

-- Window class
local Window = {}
Window.__index = Window

function Window:Destroy()
	self.Gui:Destroy()
end

function Library:CreateWindow(config)
	config = config or {}
	config.Title = config.Title or "wearelarpsUI"
	config.Size = config.Size or UDim2.new(0, 600, 0, 400)
	config.Theme = config.Theme or {
		Background = Color3.fromRGB(18, 18, 20),
		Text = Color3.fromRGB(240, 240, 240),
		Accent = Color3.fromRGB(0, 140, 255),
		Transparency = 0.05,
		Font = Enum.Font.GothamBold,
		Glow = true
	}

	local gui = create("ScreenGui", {
		Name = "wearelarpsUI_" .. HttpService:GenerateGUID(false),
		Parent = player.PlayerGui,
		ResetOnSpawn = false,
		ZIndexBehavior = Enum.ZIndexBehavior.Sibling
	})

	local main = create("Frame", {
		Parent = gui,
		Size = config.Size,
		Position = UDim2.new(0.5, -config.Size.X.Offset/2, 0.5, -config.Size.Y.Offset/2),
		BackgroundColor3 = config.Theme.Background,
		BackgroundTransparency = config.Theme.Transparency,
		BorderSizePixel = 0,
		ClipsDescendants = true
	})
	create("UICorner", {Parent = main, CornerRadius = UDim.new(0, 12)})
	create("UIStroke", {Parent = main, Thickness = 1, Color = Color3.fromRGB(40,40,40), Transparency = 0.5})

	if config.Theme.Glow then
		local glow = create("ImageLabel", {
			Parent = main,
			Size = UDim2.new(1, 40, 1, 40),
			Position = UDim2.new(0, -20, 0, -20),
			BackgroundTransparency = 1,
			Image = "rbxassetid://5028857084",
			ImageColor3 = config.Theme.Accent,
			ImageTransparency = 0.8,
			ScaleType = Enum.ScaleType.Slice,
			SliceCenter = Rect.new(20,20,20,20)
		})
	end

	local titleBar = create("Frame", {
		Parent = main,
		Size = UDim2.new(1, 0, 0, 45),
		BackgroundColor3 = config.Theme.Background,
		BackgroundTransparency = config.Theme.Transparency,
		BorderSizePixel = 0
	})
	create("UICorner", {Parent = titleBar, CornerRadius = UDim.new(0, 12)})

	local titleLabel = create("TextLabel", {
		Parent = titleBar,
		Size = UDim2.new(1, -50, 1, 0),
		Position = UDim2.new(0, 15, 0, 0),
		BackgroundTransparency = 1,
		Text = config.Title,
		TextColor3 = config.Theme.Text,
		Font = config.Theme.Font,
		TextSize = 20,
		TextXAlignment = Enum.TextXAlignment.Left
	})

	local closeBtn = create("TextButton", {
		Parent = titleBar,
		Size = UDim2.new(0, 30, 0, 30),
		Position = UDim2.new(1, -40, 0.5, -15),
		BackgroundColor3 = Color3.fromRGB(220, 60, 60),
		BackgroundTransparency = 0.3,
		Text = "✕",
		TextColor3 = Color3.new(1,1,1),
		Font = config.Theme.Font,
		TextSize = 20,
		AutoButtonColor = false,
		BorderSizePixel = 0
	})
	create("UICorner", {Parent = closeBtn, CornerRadius = UDim.new(0, 8)})

	closeBtn.MouseEnter:Connect(function()
		tween(closeBtn, {BackgroundTransparency = 0}, 0.15)
	end)
	closeBtn.MouseLeave:Connect(function()
		tween(closeBtn, {BackgroundTransparency = 0.3}, 0.15)
	end)
	closeBtn.MouseButton1Click:Connect(function()
		window:Destroy()
	end)

	-- Dragging
	local dragging = false
	local dragStart, startPos
	titleBar.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = true
			dragStart = input.Position
			startPos = main.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end)

	UserInputService.InputChanged:Connect(function(input)
		if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
			local delta = input.Position - dragStart
			main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
		end
	end)

	-- Tab container
	local tabContainer = create("Frame", {
		Parent = main,
		Size = UDim2.new(1, -20, 0, 35),
		Position = UDim2.new(0, 10, 0, 50),
		BackgroundTransparency = 1
	})
	local tabList = create("UIListLayout", {
		Parent = tabContainer,
		FillDirection = Enum.FillDirection.Horizontal,
		SortOrder = Enum.SortOrder.LayoutOrder,
		Padding = UDim.new(0, 5)
	})

	-- Content area (where tab pages go)
	local contentArea = create("Frame", {
		Parent = main,
		Size = UDim2.new(1, -20, 1, -95),
		Position = UDim2.new(0, 10, 0, 90),
		BackgroundTransparency = 1
	})

	local window = setmetatable({
		Gui = gui,
		Main = main,
		TitleBar = titleBar,
		TabContainer = tabContainer,
		ContentArea = contentArea,
		Theme = config.Theme,
		Tabs = {},
		CurrentTab = nil
	}, Window)

	function window:AddTab(name)
		local tabButton = create("TextButton", {
			Parent = self.TabContainer,
			Size = UDim2.new(0, 100, 1, 0),
			BackgroundColor3 = self.Theme.Background,
			BackgroundTransparency = self.Theme.Transparency,
			Text = name,
			TextColor3 = self.Theme.Text,
			Font = self.Theme.Font,
			TextSize = 16,
			AutoButtonColor = false,
			BorderSizePixel = 0
		})
		create("UICorner", {Parent = tabButton, CornerRadius = UDim.new(0, 8)})

		local tabPage = create("ScrollingFrame", {
			Parent = self.ContentArea,
			Size = UDim2.new(1, 0, 1, 0),
			BackgroundTransparency = 1,
			BorderSizePixel = 0,
			ScrollBarThickness = 6,
			ScrollBarImageColor3 = self.Theme.Accent,
			AutomaticCanvasSize = Enum.AutomaticSize.Y,
			CanvasSize = UDim2.new(0, 0, 0, 0),
			Visible = false
		})
		local listLayout = create("UIListLayout", {
			Parent = tabPage,
			SortOrder = Enum.SortOrder.LayoutOrder,
			Padding = UDim.new(0, 8)
		})
		local padding = create("UIPadding", {
			Parent = tabPage,
			PaddingTop = UDim.new(0, 8),
			PaddingBottom = UDim.new(0, 8)
		})

		local tab = {
			Name = name,
			Button = tabButton,
			Page = tabPage,
			ListLayout = listLayout,
			Components = {}
		}
		table.insert(self.Tabs, tab)

		tabButton.MouseButton1Click:Connect(function()
			self:SelectTab(tab)
		end)

		if #self.Tabs == 1 then
			self:SelectTab(tab)
		end

		return tab
	end

	function window:SelectTab(tab)
		if self.CurrentTab == tab then return end
		if self.CurrentTab then
			self.CurrentTab.Page.Visible = false
			tween(self.CurrentTab.Button, {BackgroundColor3 = self.Theme.Background, BackgroundTransparency = self.Theme.Transparency}, 0.2)
		end
		self.CurrentTab = tab
		tab.Page.Visible = true
		tween(tab.Button, {BackgroundColor3 = self.Theme.Accent, BackgroundTransparency = self.Theme.Transparency - 0.1}, 0.2)
	end

	function window:AddSection(tab, name)
		local section = create("Frame", {
			Parent = tab.Page,
			Size = UDim2.new(1, 0, 0, 0),
			BackgroundColor3 = self.Theme.Background,
			BackgroundTransparency = self.Theme.Transparency,
			BorderSizePixel = 0
		})
		create("UICorner", {Parent = section, CornerRadius = UDim.new(0, 8)})

		local header = create("TextLabel", {
			Parent = section,
			Size = UDim2.new(1, -20, 0, 30),
			Position = UDim2.new(0, 10, 0, 5),
			BackgroundTransparency = 1,
			Text = name,
			TextColor3 = self.Theme.Accent,
			Font = self.Theme.Font,
			TextSize = 18,
			TextXAlignment = Enum.TextXAlignment.Left
		})

		local container = create("Frame", {
			Parent = section,
			Size = UDim2.new(1, -20, 0, 0),
			Position = UDim2.new(0, 10, 0, 40),
			BackgroundTransparency = 1
		})
		local sectionList = create("UIListLayout", {
			Parent = container,
			SortOrder = Enum.SortOrder.LayoutOrder,
			Padding = UDim.new(0, 6)
		})

		local sectionObj = {
			Header = header,
			Container = container,
			ListLayout = sectionList,
			Components = {}
		}

		sectionObj.AddComponent = function(compFunc, ...)
			local component = compFunc(self, ...)
			component.Parent = container
			table.insert(sectionObj.Components, component)
			RunService.Heartbeat:Wait()
			section.Size = UDim2.new(1, 0, 0, 45 + sectionList.AbsoluteContentSize.Y)
			tab.Page.CanvasSize = UDim2.new(0, 0, 0, tab.ListLayout.AbsoluteContentSize.Y + 20)
			return component
		end

		sectionObj.AddButton = function(text, callback)
			return sectionObj.AddComponent(Window.AddButton, text, callback)
		end

		sectionObj.AddToggle = function(text, default, callback)
			return sectionObj.AddComponent(Window.AddToggle, text, default, callback)
		end

		sectionObj.AddSlider = function(text, min, max, default, integer, callback)
			return sectionObj.AddComponent(Window.AddSlider, text, min, max, default, integer, callback)
		end

		sectionObj.AddInput = function(placeholder, default, callback)
			return sectionObj.AddComponent(Window.AddInput, placeholder, default, callback)
		end

		sectionObj.AddLabel = function(text)
			return sectionObj.AddComponent(Window.AddLabel, text)
		end

		sectionObj.AddColorPicker = function(text, default, callback)
			return sectionObj.AddComponent(Window.AddColorPicker, text, default, callback)
		end

		sectionObj.AddDropdown = function(text, options, defaultIndex, callback)
			return sectionObj.AddComponent(Window.AddDropdown, text, options, defaultIndex, callback)
		end

		sectionObj.AddKeybind = function(text, default, callback)
			return sectionObj.AddComponent(Window.AddKeybind, text, default, callback)
		end

		return sectionObj
	end

	-- Component methods (now returning objects with get/set)
	function Window:AddButton(text, callback)
		local button = create("TextButton", {
			Size = UDim2.new(1, 0, 0, 40),
			BackgroundColor3 = self.Theme.Background,
			BackgroundTransparency = self.Theme.Transparency,
			Text = text,
			TextColor3 = self.Theme.Text,
			Font = self.Theme.Font,
			TextSize = 16,
			AutoButtonColor = false,
			BorderSizePixel = 0
		})
		create("UICorner", {Parent = button, CornerRadius = UDim.new(0, 8)})

		button.MouseEnter:Connect(function()
			tween(button, {BackgroundColor3 = self.Theme.Accent, BackgroundTransparency = self.Theme.Transparency - 0.1}, 0.2)
		end)
		button.MouseLeave:Connect(function()
			tween(button, {BackgroundColor3 = self.Theme.Background, BackgroundTransparency = self.Theme.Transparency}, 0.2)
		end)
		button.MouseButton1Down:Connect(function()
			tween(button, {Size = UDim2.new(0.98, 0, 0.96, 0)}, 0.1)
		end)
		button.MouseButton1Up:Connect(function()
			tween(button, {Size = UDim2.new(1, 0, 1, 0)}, 0.15)
		end)
		button.MouseButton1Click:Connect(callback)

		return button
	end

	function Window:AddToggle(text, default, callback)
		local frame = create("Frame", {
			Size = UDim2.new(1, 0, 0, 40),
			BackgroundTransparency = 1
		})

		local label = create("TextLabel", {
			Parent = frame,
			Size = UDim2.new(0.7, -5, 1, 0),
			BackgroundTransparency = 1,
			Text = text,
			TextColor3 = self.Theme.Text,
			Font = self.Theme.Font,
			TextSize = 16,
			TextXAlignment = Enum.TextXAlignment.Left
		})

		local toggleBg = create("Frame", {
			Parent = frame,
			Size = UDim2.new(0, 50, 0, 24),
			Position = UDim2.new(1, -55, 0.5, -12),
			BackgroundColor3 = default and self.Theme.Accent or Color3.fromRGB(80,80,80),
			BackgroundTransparency = self.Theme.Transparency,
			BorderSizePixel = 0
		})
		create("UICorner", {Parent = toggleBg, CornerRadius = UDim.new(1, 0)})

		local toggleThumb = create("Frame", {
			Parent = toggleBg,
			Size = UDim2.new(0, 20, 0, 20),
			Position = UDim2.new(default and 1 or 0, default and -22 or 3, 0.5, -10),
			BackgroundColor3 = Color3.new(1,1,1),
			BorderSizePixel = 0
		})
		create("UICorner", {Parent = toggleThumb, CornerRadius = UDim.new(1, 0)})

		local button = create("TextButton", {
			Parent = frame,
			Size = UDim2.new(1, 0, 1, 0),
			BackgroundTransparency = 1,
			Text = ""
		})

		local state = default
		local function setState(newState)
			state = newState
			tween(toggleBg, {BackgroundColor3 = state and self.Theme.Accent or Color3.fromRGB(80,80,80)}, 0.15)
			tween(toggleThumb, {Position = UDim2.new(state and 1 or 0, state and -22 or 3, 0.5, -10)}, 0.2)
		end

		button.MouseButton1Click:Connect(function()
			state = not state
			setState(state)
			if callback then callback(state) end
		end)

		return {
			Instance = frame,
			SetState = setState,
			GetState = function() return state end
		}
	end

	function Window:AddSlider(text, min, max, default, integer, callback)
		local frame = create("Frame", {
			Size = UDim2.new(1, 0, 0, 60),
			BackgroundTransparency = 1
		})

		local label = create("TextLabel", {
			Parent = frame,
			Size = UDim2.new(1, 0, 0, 20),
			BackgroundTransparency = 1,
			Text = text .. ": " .. tostring(default),
			TextColor3 = self.Theme.Text,
			Font = self.Theme.Font,
			TextSize = 16,
			TextXAlignment = Enum.TextXAlignment.Left
		})

		local sliderBg = create("Frame", {
			Parent = frame,
			Size = UDim2.new(1, 0, 0, 10),
			Position = UDim2.new(0, 0, 0, 30),
			BackgroundColor3 = Color3.fromRGB(60,60,60),
			BackgroundTransparency = self.Theme.Transparency,
			BorderSizePixel = 0
		})
		create("UICorner", {Parent = sliderBg, CornerRadius = UDim.new(1, 0)})

		local fill = create("Frame", {
			Parent = sliderBg,
			Size = UDim2.new((default - min) / (max - min), 0, 1, 0),
			BackgroundColor3 = self.Theme.Accent,
			BackgroundTransparency = self.Theme.Transparency - 0.1,
			BorderSizePixel = 0
		})
		create("UICorner", {Parent = fill, CornerRadius = UDim.new(1, 0)})

		local thumb = create("Frame", {
			Parent = sliderBg,
			Size = UDim2.new(0, 20, 0, 20),
			Position = UDim2.new((default - min) / (max - min), -10, 0.5, -10),
			BackgroundColor3 = Color3.new(1,1,1),
			BorderSizePixel = 0
		})
		create("UICorner", {Parent = thumb, CornerRadius = UDim.new(1, 0)})

		local dragging = false
		local function updateFromMouse(x)
			local absX = math.clamp(x - sliderBg.AbsolutePosition.X, 0, sliderBg.AbsoluteSize.X)
			local percent = absX / sliderBg.AbsoluteSize.X
			local value = min + (max - min) * percent
			if integer then value = math.floor(value + 0.5) end
			value = math.clamp(value, min, max)
			fill.Size = UDim2.new((value - min) / (max - min), 0, 1, 0)
			thumb.Position = UDim2.new((value - min) / (max - min), -10, 0.5, -10)
			label.Text = text .. ": " .. tostring(value)
			if callback then callback(value) end
			return value
		end

		local button = create("TextButton", {
			Parent = sliderBg,
			Size = UDim2.new(1, 0, 1, 0),
			BackgroundTransparency = 1,
			Text = ""
		})

		button.MouseButton1Down:Connect(function()
			dragging = true
			updateFromMouse(mouse.X)
		end)

		UserInputService.InputChanged:Connect(function(input)
			if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
				updateFromMouse(mouse.X)
			end
		end)

		UserInputService.InputEnded:Connect(function(input)
			if input.UserInputType == Enum.UserInputType.MouseButton1 then
				dragging = false
			end
		end)

		return {
			Instance = frame,
			SetValue = function(val)
				val = math.clamp(val, min, max)
				fill.Size = UDim2.new((val - min) / (max - min), 0, 1, 0)
				thumb.Position = UDim2.new((val - min) / (max - min), -10, 0.5, -10)
				label.Text = text .. ": " .. tostring(val)
				if callback then callback(val) end
			end,
			GetValue = function()
				local percent = fill.Size.X.Scale
				return min + (max - min) * percent
			end
		}
	end

	function Window:AddInput(placeholder, default, callback)
		local frame = create("Frame", {
			Size = UDim2.new(1, 0, 0, 40),
			BackgroundTransparency = 1
		})

		local box = create("TextBox", {
			Parent = frame,
			Size = UDim2.new(1, 0, 1, 0),
			BackgroundColor3 = self.Theme.Background,
			BackgroundTransparency = self.Theme.Transparency,
			PlaceholderText = placeholder,
			Text = default or "",
			TextColor3 = self.Theme.Text,
			PlaceholderColor3 = Color3.fromRGB(150,150,150),
			Font = self.Theme.Font,
			TextSize = 16,
			ClearTextOnFocus = false,
			BorderSizePixel = 0
		})
		create("UICorner", {Parent = box, CornerRadius = UDim.new(0, 8)})

		box.FocusLost:Connect(function()
			if callback then callback(box.Text) end
		end)

		return {
			Instance = frame,
			SetText = function(t) box.Text = t end,
			GetText = function() return box.Text end
		}
	end

	function Window:AddLabel(text)
		local label = create("TextLabel", {
			Size = UDim2.new(1, 0, 0, 30),
			BackgroundTransparency = 1,
			Text = text,
			TextColor3 = self.Theme.Text,
			Font = self.Theme.Font,
			TextSize = 16,
			TextXAlignment = Enum.TextXAlignment.Left
		})

		return {
			Instance = label,
			SetText = function(t) label.Text = t end,
			GetText = function() return label.Text end
		}
	end

	function Window:AddColorPicker(text, default, callback)
		local frame = create("Frame", {
			Size = UDim2.new(1, 0, 0, 40),
			BackgroundTransparency = 1
		})

		local label = create("TextLabel", {
			Parent = frame,
			Size = UDim2.new(0.7, -5, 1, 0),
			BackgroundTransparency = 1,
			Text = text,
			TextColor3 = self.Theme.Text,
			Font = self.Theme.Font,
			TextSize = 16,
			TextXAlignment = Enum.TextXAlignment.Left
		})

		local colorDisplay = create("Frame", {
			Parent = frame,
			Size = UDim2.new(0, 40, 0, 24),
			Position = UDim2.new(1, -45, 0.5, -12),
			BackgroundColor3 = default,
			BorderSizePixel = 0
		})
		create("UICorner", {Parent = colorDisplay, CornerRadius = UDim.new(0, 6)})

		local button = create("TextButton", {
			Parent = frame,
			Size = UDim2.new(1, 0, 1, 0),
			BackgroundTransparency = 1,
			Text = ""
		})

		local currentColor = default
		button.MouseButton1Click:Connect(function()
			local pickerGui = create("ScreenGui", {
				Parent = player.PlayerGui,
				Name = "ColorPicker"
			})
			local bg = create("Frame", {
				Parent = pickerGui,
				Size = UDim2.new(0, 300, 0, 350),
				Position = UDim2.new(0.5, -150, 0.5, -175),
				BackgroundColor3 = self.Theme.Background,
				BackgroundTransparency = self.Theme.Transparency,
				BorderSizePixel = 0
			})
			create("UICorner", {Parent = bg, CornerRadius = UDim.new(0, 12)})
			create("UIStroke", {Parent = bg, Thickness = 1, Color = Color3.fromRGB(40,40,40)})

			local hueSlider = create("Frame", {
				Parent = bg,
				Size = UDim2.new(1, -40, 0, 30),
				Position = UDim2.new(0, 20, 0, 250),
				BackgroundColor3 = Color3.new(1,1,1),
				BorderSizePixel = 0
			})
			for i = 0, 10 do
				local hueBlock = create("Frame", {
					Parent = hueSlider,
					Size = UDim2.new(0.1, 0, 1, 0),
					Position = UDim2.new(0.1 * i, 0, 0, 0),
					BackgroundColor3 = Color3.fromHSV(i/10, 1, 1),
					BorderSizePixel = 0
				})
			end

			local grid = create("Frame", {
				Parent = bg,
				Size = UDim2.new(1, -40, 0, 200),
				Position = UDim2.new(0, 20, 0, 40),
				BackgroundColor3 = Color3.new(1,1,1),
				BorderSizePixel = 0,
				ClipsDescendants = true
			})
			for x = 0, 10 do
				for y = 0, 10 do
					local cell = create("Frame", {
						Parent = grid,
						Size = UDim2.new(0.1, 0, 0.1, 0),
						Position = UDim2.new(0.1 * x, 0, 0.1 * y, 0),
						BackgroundColor3 = Color3.fromHSV(0, x/10, 1 - y/10),
						BorderSizePixel = 0
					})
					local btn = create("TextButton", {
						Parent = cell,
						Size = UDim2.new(1, 0, 1, 0),
						BackgroundTransparency = 1,
						Text = ""
					})
					btn.MouseButton1Click:Connect(function()
						currentColor = cell.BackgroundColor3
						colorDisplay.BackgroundColor3 = currentColor
						if callback then callback(currentColor) end
						pickerGui:Destroy()
					end)
				end
			end

			local closePicker = create("TextButton", {
				Parent = bg,
				Size = UDim2.new(0, 100, 0, 35),
				Position = UDim2.new(0.5, -50, 0, 300),
				BackgroundColor3 = self.Theme.Accent,
				BackgroundTransparency = self.Theme.Transparency,
				Text = "Close",
				TextColor3 = self.Theme.Text,
				Font = self.Theme.Font,
				TextSize = 16,
				AutoButtonColor = false,
				BorderSizePixel = 0
			})
			create("UICorner", {Parent = closePicker, CornerRadius = UDim.new(0, 8)})
			closePicker.MouseButton1Click:Connect(function()
				pickerGui:Destroy()
			end)
		end)

		return {
			Instance = frame,
			SetColor = function(c) currentColor = c; colorDisplay.BackgroundColor3 = c end,
			GetColor = function() return currentColor end
		}
	end

	function Window:AddDropdown(text, options, defaultIndex, callback)
		local frame = create("Frame", {
			Size = UDim2.new(1, 0, 0, 40),
			BackgroundTransparency = 1
		})

		local label = create("TextLabel", {
			Parent = frame,
			Size = UDim2.new(0.6, -5, 1, 0),
			BackgroundTransparency = 1,
			Text = text,
			TextColor3 = self.Theme.Text,
			Font = self.Theme.Font,
			TextSize = 16,
			TextXAlignment = Enum.TextXAlignment.Left
		})

		local dropdownBtn = create("TextButton", {
			Parent = frame,
			Size = UDim2.new(0, 120, 0, 30),
			Position = UDim2.new(1, -125, 0.5, -15),
			BackgroundColor3 = self.Theme.Background,
			BackgroundTransparency = self.Theme.Transparency,
			Text = options[defaultIndex] or options[1],
			TextColor3 = self.Theme.Text,
			Font = self.Theme.Font,
			TextSize = 14,
			AutoButtonColor = false,
			BorderSizePixel = 0
		})
		create("UICorner", {Parent = dropdownBtn, CornerRadius = UDim.new(0, 6)})

		dropdownBtn.MouseEnter:Connect(function()
			tween(dropdownBtn, {BackgroundColor3 = self.Theme.Accent}, 0.2)
		end)
		dropdownBtn.MouseLeave:Connect(function()
			tween(dropdownBtn, {BackgroundColor3 = self.Theme.Background}, 0.2)
		end)

		local dropdownContainer = create("ScrollingFrame", {
			Parent = frame,
			Size = UDim2.new(0, 120, 0, 0),
			Position = UDim2.new(1, -125, 0, 35),
			BackgroundColor3 = self.Theme.Background,
			BackgroundTransparency = self.Theme.Transparency,
			BorderSizePixel = 0,
			Visible = false,
			ScrollBarThickness = 4,
			ScrollBarImageColor3 = self.Theme.Accent,
			AutomaticCanvasSize = Enum.AutomaticSize.Y,
			CanvasSize = UDim2.new(0, 0, 0, 0),
			ZIndex = 10
		})
		create("UICorner", {Parent = dropdownContainer, CornerRadius = UDim.new(0, 6)})
		create("UIStroke", {Parent = dropdownContainer, Thickness = 1, Color = Color3.fromRGB(40,40,40)})

		local dropdownList = create("UIListLayout", {
			Parent = dropdownContainer,
			SortOrder = Enum.SortOrder.LayoutOrder,
			Padding = UDim.new(0, 2)
		})

		for i, option in ipairs(options) do
			local optBtn = create("TextButton", {
				Parent = dropdownContainer,
				Size = UDim2.new(1, 0, 0, 30),
				BackgroundColor3 = self.Theme.Background,
				BackgroundTransparency = self.Theme.Transparency,
				Text = option,
				TextColor3 = self.Theme.Text,
				Font = self.Theme.Font,
				TextSize = 14,
				AutoButtonColor = false,
				BorderSizePixel = 0,
				ZIndex = 11
			})
			optBtn.MouseEnter:Connect(function()
				tween(optBtn, {BackgroundColor3 = self.Theme.Accent}, 0.2)
			end)
			optBtn.MouseLeave:Connect(function()
				tween(optBtn, {BackgroundColor3 = self.Theme.Background}, 0.2)
			end)
			optBtn.MouseButton1Click:Connect(function()
				dropdownBtn.Text = option
				dropdownContainer.Visible = false
				if callback then callback(option) end
			end)
		end

		dropdownBtn.MouseButton1Click:Connect(function()
			dropdownContainer.Visible = not dropdownContainer.Visible
			if dropdownContainer.Visible then
				dropdownContainer.Size = UDim2.new(0, 120, 0, math.min(35 * #options, 140))
			else
				dropdownContainer.Size = UDim2.new(0, 120, 0, 0)
			end
		end)

		return {
			Instance = frame,
			SetSelected = function(option)
				dropdownBtn.Text = option
			end,
			GetSelected = function() return dropdownBtn.Text end
		}
	end

	function Window:AddKeybind(text, default, callback)
		local frame = create("Frame", {
			Size = UDim2.new(1, 0, 0, 40),
			BackgroundTransparency = 1
		})

		local label = create("TextLabel", {
			Parent = frame,
			Size = UDim2.new(0.7, -5, 1, 0),
			BackgroundTransparency = 1,
			Text = text,
			TextColor3 = self.Theme.Text,
			Font = self.Theme.Font,
			TextSize = 16,
			TextXAlignment = Enum.TextXAlignment.Left
		})

		local bindBtn = create("TextButton", {
			Parent = frame,
			Size = UDim2.new(0, 100, 0, 30),
			Position = UDim2.new(1, -105, 0.5, -15),
			BackgroundColor3 = self.Theme.Background,
			BackgroundTransparency = self.Theme.Transparency,
			Text = default and default.Name or "None",
			TextColor3 = self.Theme.Text,
			Font = self.Theme.Font,
			TextSize = 14,
			AutoButtonColor = false,
			BorderSizePixel = 0
		})
		create("UICorner", {Parent = bindBtn, CornerRadius = UDim.new(0, 6)})

		local listening = false
		local currentKey = default

		bindBtn.MouseButton1Click:Connect(function()
			listening = true
			bindBtn.Text = "..."
			local connection
			connection = UserInputService.InputBegan:Connect(function(input, gameProcessed)
				if gameProcessed then return end
				if input.UserInputType == Enum.UserInputType.Keyboard then
					currentKey = input.KeyCode
					bindBtn.Text = currentKey.Name
					listening = false
					connection:Disconnect()
					if callback then callback(currentKey) end
				end
			end)
		end)

		return {
			Instance = frame,
			SetKey = function(key)
				currentKey = key
				bindBtn.Text = key.Name
			end,
			GetKey = function() return currentKey end
		}
	end

	return window
end

return Library
